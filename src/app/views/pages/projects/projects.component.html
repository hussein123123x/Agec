<!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
<div *ngIf="!showDetails">
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
      <h4 class="mb-0">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h4>
    
      <div class="d-flex flex-wrap gap-2 align-items-center flex-grow-1 justify-content-end">
        <input type="text" class="form-control" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ø§Ù„Ù…Ø§Ù„Ùƒ"
               [(ngModel)]="searchQuery" style="max-width: 250px;" />
    
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ„ØªØ±Ø© -->
            <select class="form-select" [(ngModel)]="statusFilter" style="max-width: 180px;">
            <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
            <option value="Ø¬Ø§Ø±ÙŠ">Ø¬Ø§Ø±ÙŠ</option>
            <option value="Ù…ÙƒØªÙ…Ù„">Ù…ÙƒØªÙ…Ù„</option>
            <option value="Ù…ØªØ£Ø®Ø±">Ù…ØªØ£Ø®Ø±</option> 
            </select>
    
    
        <button class="btn btn-primary">
          + Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
        </button>
      </div>
    </div>
    
    <div class="d-flex flex-wrap justify-content-between gap-3 mb-4 text-center">
      <c-widget-stat-c color="primary" [value]="projects.length" title="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹" inverse class="flex-fill" style="min-width: 180px;"></c-widget-stat-c>
      <c-widget-stat-c color="info" [value]="activeProjects" title="Ø¬Ø§Ø±ÙŠØ©" inverse class="flex-fill" style="min-width: 180px;"></c-widget-stat-c>
      <c-widget-stat-c color="success" [value]="completedProjects" title="Ù…ÙƒØªÙ…Ù„Ø©" inverse class="flex-fill" style="min-width: 180px;"></c-widget-stat-c>
      <c-widget-stat-c color="warning" [value]="nearProjects" title="Ø§Ù‚ØªØ±Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„ØªØ³Ù„ÙŠÙ…" inverse class="flex-fill" style="min-width: 180px;"></c-widget-stat-c>
      <c-widget-stat-c color="danger" [value]="delayedProjects" title="Ù…ØªØ£Ø®Ø±Ø©" inverse class="flex-fill" style="min-width: 180px;"></c-widget-stat-c>
    </div>
    
    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
    <div class="row">
      <div class="col-md-6 mb-4" *ngFor="let project of filteredProjects">
        <div class="card h-100 shadow-sm" [ngClass]="getCardBorderClass(project.dueDate, project.status)">
          <div class="card-body">
            <h5 class="mb-3">
            ğŸ“ {{ project.name }}
            
            <ng-container *ngIf="project.status !== 'Ù…ÙƒØªÙ…Ù„'">
              - Ù…ØªØ¨Ù‚ÙŠ {{ getRemainingDays(project.dueDate) }} ÙŠÙˆÙ…
            </ng-container>
          </h5>

            <p><strong>Ø§Ù„ØªÙ‚Ø¯Ù…:</strong> {{ project.progress }}</p>
            <p *ngIf="project.status !== 'Ù…ÙƒØªÙ…Ù„'">
              <strong>ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong>
              <span [ngClass]="{
                'text-success': getProjectPerformance(project.progress, project.dueDate, project.startDate) === 'Ù…Ù…ØªØ§Ø²',
                'text-primary': getProjectPerformance(project.progress, project.dueDate, project.startDate) === 'Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§',
                'text-info': getProjectPerformance(project.progress, project.dueDate, project.startDate) === 'Ø¬ÙŠØ¯',
                'text-warning': getProjectPerformance(project.progress, project.dueDate, project.startDate) === 'Ù…ØªØ£Ø®Ø±',
                'text-danger': getProjectPerformance(project.progress, project.dueDate, project.startDate) === 'Ù…ØªØ£Ø®Ø± Ø¬Ø¯Ù‹Ø§'
              }">
                {{ getProjectPerformance(project.progress, project.dueDate, project.startDate) }}
              </span>
            </p>
            <p><strong>Ø§Ù„Ù…Ø§Ù„Ùƒ:</strong> {{ project.owner }}</p>
            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</strong> {{ project.startDate }}</p>
            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…:</strong> {{ project.dueDate }}</p>
           <p *ngIf="project.status !== 'Ù…ÙƒØªÙ…Ù„'"><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</strong> {{ getRemainingDays(project.dueDate) }} ÙŠÙˆÙ…</p>
            <p *ngIf="getDelayDays(project.dueDate, project.status) > 0" class="text-danger">
            <strong>Ù…ØªØ£Ø®Ø±:</strong> {{ getDelayDays(project.dueDate, project.status) }} ÙŠÙˆÙ…
            </p>
            <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> 
              <c-badge [color]="getStatusColor(project.status)" class="me-1 ms-2 px-2 py-2">
                {{ project.status }}
              </c-badge>
            </p>
          </div>
          <div class="card-footer d-flex justify-content-end gap-2">
            <button class="btn btn-sm btn-outline-info" (click)="viewProject(project)">Ø¹Ø±Ø¶</button>
            <button class="btn btn-sm btn-outline-primary">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn btn-sm btn-outline-danger">Ø­Ø°Ù</button>
          </div>
        </div>
      </div>
    </div>
</div>

<div *ngIf="showDetails" class="project-details-container p-4 rounded shadow">
  <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-4">
  <h4 class="mb-0 text-primary fw-bold">
     ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: {{ selectedProject.name }}
  </h4>

  <button class="btn btn-outline-secondary btn-sm" (click)="closeDetails()">
    <i class="bi bi-x-lg me-1"></i> Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
  </button>
</div>

  

  <div class="row">

    <div class="col-md-12">

      <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø© -->
      <div class="row mb-4">

      <!-- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
      <div class="col-md-6">
        <h6 class="text-secondary mb-3">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h6>
        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> 
          <c-badge [color]="getStatusColor(selectedProject.status)">
            {{ selectedProject.status }}
          </c-badge>
        </p>
        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…:</strong> {{ selectedProject.dueDate }}</p>
        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</strong> {{ getRemainingDays(selectedProject.dueDate) }} ÙŠÙˆÙ…</p>
        <p><strong>ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong> 
          {{ getProjectPerformance(selectedProject.progress, selectedProject.dueDate, selectedProject.startDate) }}
        </p>
        <p><strong>Ø§Ù„Ù…Ø§Ù„Ùƒ:</strong> {{ selectedProject.owner }}</p>
        <p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> {{ selectedProject.location }}</p>
        <p><strong>Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</strong> {{ selectedProject.engineerInCharge }}</p>
      </div>

      <!-- Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² -->
      <div class="col-md-6 text-center">
        <h6 class="text-secondary mb-3">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</h6>
        <p><strong>{{ selectedProject.progress }}</strong></p>
        <div style="width: 200px; height: 200px; margin: auto;">
          <canvas #progressChart style="width: 100% !important; height: 100% !important;"></canvas>
        </div>
      </div>

      </div>

      <!-- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© -->
      <div class="row mt-4">
  <div class="col-md-12">
    <h6 class="text-secondary mb-3">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h6>
    <div class="card border rounded shadow-sm p-3">

      <div class="row">
        <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ -->
        <div class="col-md-6">
          <p><strong>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong>
            {{ selectedProject.financial?.projectValue  }}
          </p>

          <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ØµÙ„:</strong>
            {{ selectedProject.financial?.receivedAmount | currency:'EGP':'symbol':'1.0-0' }}
          </p>

          <p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„:</strong>
            <span class="badge bg-primary">
              {{ getCollectionPercentage(selectedProject) | number:'1.0-0' }}%
            </span>
          </p>
        </div>

        <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ -->
        <div class="col-md-6">
          <p><strong>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:</strong>
            {{ selectedProject.financial?.estimatedCost | currency:'EGP':'symbol':'1.0-0' }}
          </p>

          <p><strong>Ø§Ù„Ù…ØµØ±ÙˆÙ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†:</strong>
            {{ selectedProject.financial?.spentCost | currency:'EGP':'symbol':'1.0-0' }}
          </p>

          <p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„ØµØ±Ù:</strong>
            <span class="badge bg-info text-dark">
              {{ getSpentPercentage(selectedProject) | number:'1.0-0' }}%
            </span>
          </p>
        </div>
      </div>

      <hr />

      <div class="row mt-3">
        <div class="col-md-6">
          <p><strong>ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø£Ø¯ÙˆØ§Øª:</strong>
            {{ selectedProject.financial?.toolsCost | currency:'EGP':'symbol':'1.0-0' }}
          </p>
        </div>

        <div class="col-md-6">
          <p><strong>Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ù†ÙØ°Ø©:</strong>
            {{ selectedProject.financial?.executedHours }} Ø³Ø§Ø¹Ø©
          </p>
        </div>
      </div>

      <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ù† ÙˆØ¬Ø¯Øª -->
      <div *ngIf="selectedProject.financial?.notes" class="mt-3">
        <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> {{ selectedProject.financial.notes }}</p>
      </div>

    </div>
  </div>
</div>


      <div *ngIf="flag">

        <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
        <!-- <div class="mb-4">
          <h6 class="text-secondary mb-2">Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</h6>
          <ul class="list-group">
            <li *ngFor="let product of selectedProject.products" class="list-group-item d-flex justify-content-between align-items-center">
              {{ product.name }} 
              <span class="ms-auto">
                (Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: {{ product.quantityRequired }}) -
                <span [class.text-success]="product.inStock" [class.text-danger]="!product.inStock">
                  {{ product.inStock ? 'Ù…ØªÙˆÙØ±' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±' }}
                </span>
              </span>
            </li>
          </ul>
        </div> -->
  
        <!-- Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
        <div class="mb-4">
    <h6 class="text-primary fw-bold mb-3">Ø§Ù„Ù…Ø±Ø§Ø­Ù„</h6>
  
    <!-- Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div *ngFor="let phase of selectedProject.phases" class="border-start border-4 ps-3 mb-4">
      <div class="d-flex justify-content-between align-items-center mb-1">
        <strong class="text-dark">{{ phase.name }}</strong>
        <span class="badge" [ngClass]="getBadgeClass(phase.status)">
          {{ phase.status }}
        </span>
      </div>
  
      <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø© -->
      <div *ngIf="phase.notes?.length" class="text-muted small mb-2">
        <ul class="mb-1 ps-3">
          <li *ngFor="let note of phase.notes">
            ğŸ“Œ {{ note.content }} â€“ {{ note.author }} ({{ note.date }})
          </li>
        </ul>
      </div>
  
      <!-- Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ÙØ±Ø¹ÙŠØ© -->
      <div *ngFor="let sub of phase.subPhases" class="ps-3 border-start border-2 ms-2 mb-3">
        <div class="d-flex justify-content-between align-items-center">
          <span>{{ sub.name }}</span>
          <span class="badge" [ngClass]="getBadgeClass(sub.status)">
            {{ sub.status }}
          </span>
        </div>
  
        <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª subPhase -->
        <div *ngIf="sub.notes?.length" class="text-muted small mt-1">
          <ul class="mb-1 ps-3">
            <li *ngFor="let note of sub.notes">
              ğŸ“Œ {{ note.content }} â€“ {{ note.author }} ({{ note.date }})
            </li>
          </ul>
        </div>
  
        <!-- Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙØ±Ø¹ÙŠØ© -->
        <div *ngFor="let subSub of sub.subPhases" class="ps-3 ms-2 mt-2 border-start border-1">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-muted small">{{ subSub.name }}</span>
            <span class="badge" [ngClass]="getBadgeClass(subSub.status)">
              {{ subSub.status }}
            </span>
          </div>
  
           <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª subSub -->
          <div *ngIf="subSub.notes?.length" class="text-muted small mt-1 ps-3">
            <ul class="mb-1">
              <li *ngFor="let note of subSub.notes">
                ğŸ“Œ {{ note.content }} â€“ {{ note.author }} ({{ note.date }})
              </li>
            </ul>
          </div>
        </div>
  
        
      </div>
    </div>
        </div>
  
  
  
  
  
        <!-- Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª -->
        <div *ngIf="selectedProject.requirements?.length">
          <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª:</strong> {{ selectedProject.requirements.length }}</p>
          <p><strong>ÙˆØµÙ:</strong> {{ selectedProject.description }}</p>
          <div>
            <strong>Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª:</strong>
            <ul class="mb-2">
              <li *ngFor="let req of selectedProject.requirements">{{ req }}</li>
            </ul>
          </div>
        </div>
  
        <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙÙ†ÙŠØ© -->
        <div *ngIf="selectedProject.notes?.length" class="mt-4">
          <h6 class="text-secondary mb-2">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙÙ†ÙŠØ©</h6>
          <div *ngFor="let note of selectedProject.notes" class="border rounded p-3 mb-2 bg-light">
            <div class="d-flex justify-content-between">
              <strong>{{ note.author }}</strong>
              <small class="text-muted">{{ note.date }}</small>
            </div>
            <p class="mb-0 mt-2">{{ note.content }}</p>
          </div>
        </div>
      </div>
      

      <div></div>

    </div>

  </div>

</div>

