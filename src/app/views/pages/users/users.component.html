
<!-- ุงูุชุจููุจุงุช -->
<ul class="nav nav-tabs mb-3">
  <li class="nav-item">
    <button class="nav-link" [class.active]="activeTab === 'employees'" (click)="activeTab = 'employees'">
      ุงูููุธููู
    </button>
  </li>
  <li class="nav-item">
    <button class="nav-link" [class.active]="activeTab === 'vacations'" (click)="activeTab = 'vacations'">
      ุงูุฅุฌุงุฒุงุช ุงูุฑุณููุฉ
    </button>
  </li>
  <li class="nav-item">
    <button class="nav-link" [class.active]="activeTab === 'applicants'" (click)="activeTab = 'applicants'">
      ุงูุงุฑุดูู
    </button>
  </li>
</ul>


<!-- ุงูููุธููู: ุงูุตูุญุฉ ุงููุงููุฉ ูููุงุฌูุฉ ุงูุฃูุงููุฉ -->
<c-card class="mb-4" *ngIf="activeTab === 'employees'">
  <c-card-header class="d-flex justify-content-between align-items-center">
    <h5 class="mb-0">ุฅุฏุงุฑุฉ ุงูููุธููู</h5>
    <div class="d-flex gap-2">
      <div class="input-group me-2">
        <input type="text" class="form-control text-xs" placeholder="ุจุญุซ ">
        <button class="btn btn-primary">ุจุญุซ</button>
      </div>
      <button class="btn btn-light" (click)="openForm()">ุฅุถุงูุฉ ููุธู</button>
      <button class="btn btn-light">ุงุณุชูุฑุงุฏ</button>
      <button class="btn btn-light">ุชุตุฏูุฑ</button>
      <button class="btn btn-light">ุชุญุฏูุซ</button>
      <button class="btn btn-light">ุทุจุงุนุฉ</button>
    </div>
  </c-card-header>

  <!-- ุฅุญุตุงุฆูุงุช ููุฌุฒุฉ -->
  <c-card-body>
    <c-row class="mb-4 text-center">
      <c-col sm="6" md="3">
        <c-widget-stat-c color="primary" value="120" [title]="'ุฅุฌูุงูู ุงูููุธููู'" inverse>
          <ng-template cTemplateId="widgetIconTemplate">
            <svg cIcon name="cil-people" height="36"></svg>
          </ng-template>
        </c-widget-stat-c>
      </c-col>
      <c-col sm="6" md="3">
        <c-widget-stat-c color="success" value="96" [title]="'ูุดุทูู'" inverse>
          <ng-template cTemplateId="widgetIconTemplate">
            <svg cIcon name="cil-check-circle" height="36"></svg>
          </ng-template>
        </c-widget-stat-c>
      </c-col>
      <c-col sm="6" md="3">
        <c-widget-stat-c color="danger" value="24" [title]="'ููููููู'" inverse>
          <ng-template cTemplateId="widgetIconTemplate">
            <svg cIcon name="cil-ban" height="36"></svg>
          </ng-template>
        </c-widget-stat-c>
      </c-col>
      <c-col sm="6" md="3">
        <c-widget-stat-c color="warning" value="6" [title]="'ุฃูุณุงู'" inverse>
          <ng-template cTemplateId="widgetIconTemplate">
            <svg cIcon name="cil-building" height="36"></svg>
          </ng-template>
        </c-widget-stat-c>
      </c-col>
    </c-row>

    <!-- ุฌุฏูู ุงูููุธููู -->
    <div class="table-responsive border">
  <table class="table table-hover table-striped align-middle mb-0">
    <thead class="table-light">
      <tr>
        <th class="d-none d-md-table-cell">ุงูุตูุฑุฉ</th>
        <th>ุงูุงุณู</th>
        <th>ุงูุฑูู ุงููุธููู</th>
        <th class="d-none d-md-table-cell">ุงููุณู</th>
        <th class="d-none d-md-table-cell">ุงููุธููุฉ</th>
        <th class="d-none d-md-table-cell">ุชุงุฑูุฎ ุงูุชุนููู</th>
        <th>ุงูุบูุงุจ </th>
        <th>ุงูุชููู</th>
        <th class="d-none d-md-table-cell">ุงูุญุงูุฉ</th>
        <th>ุฅุฌุฑุงุกุงุช</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let employee of employees">
        <td class="d-none d-md-table-cell"><c-avatar [src]="employee.image" size="md" /></td>
        <td>{{ employee.name }}</td>
        <td>{{ employee.code }}</td>
        <td class="d-none d-md-table-cell">{{ employee.department }}</td>
        <td class="d-none d-md-table-cell">{{ employee.jobTitle }}</td>
        <td class="d-none d-md-table-cell">{{ employee.hireDate }}</td>
        <td>{{ employee.absenceDays }}</td>
        <td>{{ employee.kpi }} %</td>
        <td class="d-none d-md-table-cell">
          <c-badge [color]="employee.status === 'ูุดุท' ? 'success' : 'warning'">
            {{ employee.status }}
          </c-badge>
        </td>
        <td>
            <div class="d-flex flex-wrap gap-1 justify-content-center">
                <button class="btn btn-light btn-sm" title="ุนุฑุถ" (click)="showDetails(employee)">
                <svg cIcon name="cil-magnifying-glass" size="sm"></svg>
                </button>
                <button class="btn btn-light btn-sm" title="ุชุนุฏูู" (click)="editEmployee(employee)">
                <svg cIcon name="cil-pencil" size="sm"></svg>
                </button>
                <button class="btn btn-light btn-sm" title="ุญุฐู" (click)="deleteEmployee(employee)">
                <svg cIcon name="cil-trash" size="sm"></svg>
                </button>
            </div>
            </td>

      </tr>
    </tbody>
  </table>
</div>

  </c-card-body>
</c-card>

<div *ngIf="activeTab === 'vacations'">
  <div class="card p-3" style="margin-bottom: 20px">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h6 class="fw-bold text-secondary mb-0">ุงูุฅุฌุงุฒุงุช ุงูุฑุณููุฉ</h6>
      <button class="btn btn-sm btn-outline-primary" (click)="showVacationForm = !showVacationForm">
        {{ showVacationForm ? 'ุฅุบูุงู ุงููููุฐุฌ' : 'ุฅุถุงูุฉ ุฅุฌุงุฒุฉ' }}
      </button>
    </div>

    <!-- โ ูููุฐุฌ ุงูุฅุถุงูุฉ -->
    <form *ngIf="showVacationForm" [formGroup]="vacationForm">
      <div class="row g-4 align-items-end">
        <!-- ูู - ุฅูู -->
        <div class="col-md-6 col-lg-4">
          <label class="form-label fw-semibold">ูู ุชุงุฑูุฎ</label>
          <input type="date" class="form-control" formControlName="fromDate" />
        </div>
        <div class="col-md-6 col-lg-4">
          <label class="form-label fw-semibold">ุฅูู ุชุงุฑูุฎ</label>
          <input type="date" class="form-control" formControlName="toDate" />
        </div>

        <div class="col-md-6 col-lg-4">
          <label class="form-label fw-semibold">ุณุจุจ ุงูุฅุฌุงุฒุฉ</label>
          <input type="text" class="form-control" formControlName="reason" />
        </div>

        <!-- ุงูุชูุงุตูู -->
        <div class="col-12">
          <label class="form-label fw-semibold">ุชูุงุตูู ุฅุถุงููุฉ</label>
          <textarea rows="2" class="form-control" formControlName="details" placeholder="ุชูุงุตูู ุงูุฅุฌุงุฒุฉ..."></textarea>
        </div>

        <!-- ุงูููุธููู -->
        <div class="col-12">
          <label class="form-label fw-semibold">ุงุฎุชุฑ ุงูููุธููู</label>
          <div class="border rounded p-3" style="max-height: 250px; overflow-y: auto;">
            <ul class="list-unstyled mb-0">
              <li *ngFor="let emp of employees"
                  class="d-flex align-items-center justify-content-between p-2 rounded mb-1"
                  [class.bg-light]="selectedEmployees.includes(emp.id)"
                  (click)="toggleEmployee(emp.id)"
                  style="cursor: pointer;">
                <div class="form-check">
                  <input type="checkbox"
                         class="form-check-input"
                         [checked]="selectedEmployees.includes(emp.id)"
                         (change)="toggleEmployee(emp.id); $event.stopPropagation();"
                         id="emp{{ emp.id }}" />
                  <label class="form-check-label ms-2" for="emp{{ emp.id }}">
                    {{ emp.name }}
                  </label>
                </div>
                <small class="text-muted">{{ emp.jobTitle }}</small>
              </li>
            </ul>
          </div>
          <button type="button" class="btn btn-sm btn-outline-primary mt-2" (click)="selectAllEmployees()">
            ุชุญุฏูุฏ ุงููู
          </button>
        </div>

        <!-- ุชุฃููุฏ -->
        <div class="col-12 text-end">
          <button type="button" class="btn btn-primary mt-3 px-5" (click)="assignOfficialVacation()">
            <svg cIcon name="cil-check" class="me-2"></svg> ุชุฃููุฏ ุงูุฅุฌุงุฒุฉ
          </button>
        </div>

        <br>
      </div>
    </form>

    

    <!-- โ ุนุฑุถ ุงูุฅุฌุงุฒุงุช ุงููุณุฌูุฉ -->
    <div *ngIf="officialVacations.length > 0 && !showVacationForm" class="table-responsive mb-4">
      <table class="table table-striped table-sm">
        <thead class="table-light">
          <tr>
            <th>ุงูุณุจุจ</th>
            <th>ุงูุชูุงุตูู</th>
            <th> ุงูููุธููู </th>
            <th>ูู</th>
            <th>ุฅูู</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let vac of officialVacations">
            <td>{{ vac.reason }}</td>
            <td>{{ vac.details }}</td>
            <td>
              <ng-container *ngIf="vac.isAllSelected; else selectedList">
                 ุชู ุชุญุฏูุฏ ุฌููุน ุงูููุธููู ({{ vac.employees.length }})
              </ng-container>
              <ng-template #selectedList>
                <ul class="mb-0 list-unstyled small">
                  <li *ngFor="let emp of vac.employees">๐ค {{ emp.name }}</li>
                </ul>
              </ng-template>
            </td>
            <td>{{ vac.fromDate }}</td>
            <td>{{ vac.toDate }}</td>
          </tr>
        </tbody>
      </table>

    </div>

    
  </div>
</div>


<div *ngIf="activeTab === 'applicants'">
  <div class="card p-3">
    <h6 class="fw-bold mb-3 text-secondary">ุงููุชูุฏููู ุบูุฑ ุงููุนูููู</h6>
    <table class="table table-hover table-striped">
      <thead class="table-light">
        <tr>
          <th>ุงูุงุณู</th>
          <th>ุงูุจุฑูุฏ</th>
          <th>ุฑูู ุงููุงุชู</th>
          <th>ุงููุคููุงุช</th>
          <th>ููุงุญุธุงุช</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let applicant of applicants">
          <td>{{ applicant.name }}</td>
          <td>{{ applicant.email }}</td>
          <td>{{ applicant.phone }}</td>
          <td>{{ applicant.qualification }}</td>
          <td>{{ applicant.notes }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>




<c-modal [visible]="showModal()" (visibleChange)="showModal.set($event)">
  <c-modal-header>
    <strong>{{ editMode ? 'ุชุนุฏูู ููุธู' : 'ุฅุถุงูุฉ ููุธู' }}</strong>
  </c-modal-header>

  <c-modal-body>
    <form [formGroup]="employeeForm">
      <c-row class="g-3">
        <c-col xs="12" md="6">
          <label>ุงูุงุณู ุงููุงูู</label>
          <input type="text" class="form-control" formControlName="name" />
        </c-col>

        <c-col xs="12" md="6">
          <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
          <input type="email" class="form-control" formControlName="email" />
        </c-col>

        <c-col xs="12" md="6">
          <label>ุฑูู ุงููุงุชู</label>
          <input type="text" class="form-control" formControlName="phone" />
        </c-col>

        <c-col xs="12" md="6">
          <label>ุงูุฑูู ุงููุธููู</label>
          <input type="text" class="form-control" formControlName="code" />
        </c-col>

        <c-col xs="12" md="6">
          <label>ุงููุณู</label>
          <select class="form-select" formControlName="department">
            <option>ุงูุฅูุชุงุฌ</option>
            <option>ุงููุญุงุณุจุฉ</option>
            <option>ุงูุฏุนู ุงูููู</option>
          </select>
        </c-col>

        <c-col xs="12" md="6">
          <label>ุงููุธููุฉ</label>
          <input type="text" class="form-control" formControlName="jobTitle" />
        </c-col>

        <c-col xs="12" md="6">
          <label>ุงูุญุงูุฉ</label>
          <select class="form-select" formControlName="status">
            <option value="ูุดุท">ูุดุท</option>
            <option value="ููููู">ููููู</option>
          </select>
        </c-col>

        <c-col xs="12" md="6">
          <label>ุชุญููู ุตูุฑุฉ</label>
          <input type="file" class="form-control" />
        </c-col>

        <c-col xs="12" md="6">
          <label>ุงูุฑุงุชุจ</label>
          <input type="number" class="form-control" formControlName="salary" />
        </c-col>

        <c-col xs="12" md="6">
          <label>ูุคุดุฑ ุงูุฃุฏุงุก KPI (%)</label>
          <input type="number" class="form-control" formControlName="kpi" />
        </c-col>

        <c-col xs="12" md="6">
          <label>ุนุฏุฏ ุฃูุงู ุงูุบูุงุจ</label>
          <input type="number" class="form-control" formControlName="absenceDays" />
        </c-col>

        <c-col xs="12" md="6">
          <label>ุงูุนููุงู</label>
          <input type="text" class="form-control" formControlName="address" />
        </c-col>
      </c-row>
    </form>
  </c-modal-body>

  <c-modal-footer>
    <button class="btn btn-secondary" (click)="showModal.set(false)">ุฅูุบุงุก</button>
    <button class="btn btn-primary" (click)="save()">ุญูุธ</button>
  </c-modal-footer>
</c-modal>


<c-modal [visible]="showModal()" (visibleChange)="showModal.set($event)">
  <c-modal-header>
    <strong *ngIf="!selectedEmployee">ุฅุถุงูุฉ / ุชุนุฏูู ููุธู</strong>
    <strong *ngIf="selectedEmployee">ุชูุงุตูู ุงูููุธู</strong>
    <c-avatar [src]="selectedEmployee?.image" size="md" />
  </c-modal-header>

  <c-modal-body *ngIf="selectedEmployee">

    <ul class="list-group">
    <li class="list-group-item"><strong>ุงูุงุณู:</strong> {{ selectedEmployee.name }}</li>
    <li class="list-group-item"><strong>ุงูุฑูู ุงููุธููู:</strong> {{ selectedEmployee.code }}</li>
    <li class="list-group-item"><strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> {{ selectedEmployee.email }}</li>
    <li class="list-group-item"><strong>ุงููุงุชู:</strong> {{ selectedEmployee.phone }}</li>
    <li class="list-group-item"><strong>ุงูุนููุงู:</strong> {{ selectedEmployee.address }}</li>
    <li class="list-group-item"><strong>ุงูุนูุฑ:</strong> {{ selectedEmployee.age }}</li>
    <li class="list-group-item"><strong>ุงููุณู:</strong> {{ selectedEmployee.department }}</li>
    <li class="list-group-item"><strong>ุงููุธููุฉ:</strong> {{ selectedEmployee.jobTitle }}</li>
    <li class="list-group-item"><strong>ุชุงุฑูุฎ ุงูุชุนููู:</strong> {{ selectedEmployee.hireDate }}</li>
    <li class="list-group-item"><strong>ุงูุญุงูุฉ:</strong> {{ selectedEmployee.status }}</li>
    <li class="list-group-item"><strong>ุงูุฑุงุชุจ:</strong> {{ selectedEmployee.salary | currency:'EGP' }}</li>
    <li class="list-group-item"><strong>ูุคุดุฑ ุงูุฃุฏุงุก (KPI):</strong> {{ selectedEmployee.kpi }}%</li>
    <li class="list-group-item"><strong>ุนุฏุฏ ุฃูุงู ุงูุบูุงุจ:</strong> {{ selectedEmployee.absenceDays }}</li>
    <li *ngIf="selectedEmployee.takingMoney" class="list-group-item"><strong>ุณููุฉ:</strong> {{ selectedEmployee.takingMoney | currency:'EGP' }}</li>
    <li *ngIf="selectedEmployee.notes" class="list-group-item"><strong>ููุงุญุธุงุช</strong> {{ selectedEmployee.notes }}</li>
    </ul>
  </c-modal-body>
</c-modal>
